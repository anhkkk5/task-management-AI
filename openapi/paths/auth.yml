authRegister:
  post:
    tags:
      - Auth
    summary: Đăng ký
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../openapi.yml#/components/schemas/RegisterRequest"
    responses:
      "201":
        description: Tạo OTP và lưu đăng ký tạm
        content:
          application/json:
            schema:
              $ref: "../components/schemas/auth.yml#/RegisterOtpResponse"
      "400":
        description: Dữ liệu không hợp lệ
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "409":
        description: Email đã tồn tại
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authSendOtp:
  post:
    tags:
      - Auth
    summary: Gửi OTP (khi đang có đăng ký pending)
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas/auth.yml#/SendOtpRequest"
    responses:
      "200":
        description: Đã gửi OTP
        content:
          application/json:
            schema:
              $ref: "../components/schemas/auth.yml#/SendOtpResponse"
      "400":
        description: Dữ liệu không hợp lệ
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "404":
        description: Không có đăng ký pending
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authResendOtp:
  post:
    tags:
      - Auth
    summary: Gửi lại OTP
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas/auth.yml#/SendOtpRequest"
    responses:
      "200":
        description: Đã gửi OTP
        content:
          application/json:
            schema:
              $ref: "../components/schemas/auth.yml#/SendOtpResponse"
      "400":
        description: Dữ liệu không hợp lệ
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "404":
        description: Không có đăng ký pending
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authVerifyOtp:
  post:
    tags:
      - Auth
    summary: Xác thực OTP và tạo tài khoản trong DB
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas/auth.yml#/VerifyOtpRequest"
    responses:
      "200":
        description: Xác thực thành công
        content:
          application/json:
            schema:
              $ref: "../components/schemas/auth.yml#/VerifyOtpResponse"
      "400":
        description: OTP sai hoặc hết hạn
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "404":
        description: Không có đăng ký pending
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "409":
        description: Email đã tồn tại
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authLogin:
  post:
    tags:
      - Auth
    summary: Đăng nhập
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../openapi.yml#/components/schemas/LoginRequest"
    responses:
      "200":
        description: Đăng nhập thành công
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/AuthResponse"
      "400":
        description: Dữ liệu không hợp lệ
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "401":
        description: Sai email hoặc mật khẩu
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "429":
        description: Thử quá nhiều lần
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authRefreshToken:
  post:
    tags:
      - Auth
    summary: Làm mới access token bằng refresh token
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas/auth.yml#/RefreshTokenRequest"
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              $ref: "../components/schemas/auth.yml#/RefreshTokenResponse"
      "400":
        description: Thiếu refresh token
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "401":
        description: Refresh token không hợp lệ / đã bị thu hồi
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "404":
        description: Không tìm thấy người dùng
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authLogout:
  post:
    tags:
      - Auth
    summary: Đăng xuất (thu hồi refresh token hiện tại)
    requestBody:
      required: false
      content:
        application/json:
          schema:
            $ref: "../components/schemas/auth.yml#/RefreshTokenRequest"
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              $ref: "../components/schemas/auth.yml#/LogoutResponse"
      "400":
        description: Thiếu refresh token
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "401":
        description: Refresh token không hợp lệ
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authLogoutAll:
  post:
    tags:
      - Auth
    summary: Đăng xuất tất cả thiết bị
    security:
      - bearerAuth: []
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              $ref: "../components/schemas/auth.yml#/LogoutResponse"
      "401":
        description: Chưa đăng nhập / token không hợp lệ
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authMe:
  get:
    tags:
      - Auth
    summary: Lấy thông tin user hiện tại
    security:
      - bearerAuth: []
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/MeResponse"
      "401":
        description: Chưa đăng nhập / token không hợp lệ
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "404":
        description: Không tìm thấy người dùng
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authUpdateProfile:
  patch:
    tags:
      - Auth
    summary: Cập nhật hồ sơ
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../openapi.yml#/components/schemas/UpdateProfileRequest"
    responses:
      "200":
        description: Cập nhật thành công
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  $ref: "../openapi.yml#/components/schemas/User"
      "400":
        description: Dữ liệu không hợp lệ
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "401":
        description: Chưa đăng nhập / token không hợp lệ
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "404":
        description: Không tìm thấy người dùng
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authForgotPassword:
  post:
    tags:
      - Auth
    summary: Quên mật khẩu - Gửi OTP
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas/auth.yml#/ForgotPasswordRequest"
    responses:
      "200":
        description: Đã gửi OTP
        content:
          application/json:
            schema:
              $ref: "../components/schemas/auth.yml#/ForgotPasswordResponse"
      "400":
        description: Dữ liệu không hợp lệ
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "404":
        description: Không tìm thấy người dùng
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authVerifyForgotPasswordOtp:
  post:
    tags:
      - Auth
    summary: Quên mật khẩu - Xác thực OTP
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas/auth.yml#/VerifyForgotPasswordOtpRequest"
    responses:
      "200":
        description: Xác thực OTP thành công
        content:
          application/json:
            schema:
              $ref: "../components/schemas/auth.yml#/VerifyForgotPasswordOtpResponse"
      "400":
        description: OTP sai hoặc đã hết hạn
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "404":
        description: Không tìm thấy người dùng
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"

authResetPassword:
  post:
    tags:
      - Auth
    summary: Quên mật khẩu - Đặt lại mật khẩu
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas/auth.yml#/ResetPasswordRequest"
    responses:
      "200":
        description: Đặt lại mật khẩu thành công
        content:
          application/json:
            schema:
              $ref: "../components/schemas/auth.yml#/ResetPasswordResponse"
      "400":
        description: Dữ liệu không hợp lệ hoặc OTP đã hết hạn
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
      "404":
        description: Không tìm thấy người dùng
        content:
          application/json:
            schema:
              $ref: "../openapi.yml#/components/schemas/ErrorResponse"
